/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/eventPage2.ts":
/*!***************************!*\
  !*** ./src/eventPage2.ts ***!
  \***************************/
/***/ (function() {


// Generated by CoffeeScript 1.12.5
// @ts-nocheck
(function () {
    // initialize variables
    const DEFAULT_SITES = [
        {
            hostSuffix: "reddit.com",
            useDefaultExplanation: true,
            explanation: "Productivity",
        },
        {
            hostSuffix: "news.ycombinator.com",
            useDefaultExplanation: true,
            explanation: "Productivity",
        },
        {
            hostSuffix: "facebook.com",
            useDefaultExplanation: true,
            explanation: "Productivity",
        },
        {
            hostSuffix: "twitter.com",
            useDefaultExplanation: true,
            explanation: "Productivity",
        },
        {
            hostSuffix: "mako.co.il",
            useDefaultExplanation: true,
            explanation: "Productivity",
        },
        {
            hostSuffix: "ynet.co.il",
            useDefaultExplanation: true,
            explanation: "Productivity",
        },
    ], urlRegex = /^(([^:\/?#]+):)?(\/\/([^\/:?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;
    let storage = chrome.storage.sync, cooldown = 5, fullSites = DEFAULT_SITES;
    let filter = {
        url: DEFAULT_SITES.map((site) => ({ hostSuffix: site.hostSuffix })),
    };
    /* The listener is where most of the action happens. This code fires on page navigate and is where we inject the content script.
       At this point filtering has already happened so we must be on one of the sites in our filter list. */
    let listener = function (event) {
        // Here we check that we are on the main frame, and not in some kind of an iframe.
        if (event.frameId > 0) {
            return;
        }
        let contentScriptExecuting = chrome.tabs.executeScript(event.tabId, {
            file: "src/content2.js",
            runAt: "document_start",
        });
        let currentTabUrlBroken = urlRegex.exec(event.url);
        let domain = currentTabUrlBroken != null ? currentTabUrlBroken[4] : undefined;
        // if we couldn't find the domain then we stop running the function.
        if (!domain) {
            console.log("No domain found");
            return;
        }
        // find the current site object
        let theCurrentSiteObject = fullSites.find((site) => domain.match(new RegExp(site.hostSuffix + "$")));
        let explanation = theCurrentSiteObject.explanation;
        chrome.tabs.sendMessage(event.tabId, { explanation: explanation });
        return contentScriptExecuting;
    };
    let tabReplacedListener = function (event) {
        return chrome.tabs.get(event.tabId, function (tab) {
            let currentTabUrlBroken = urlRegex.exec(tab.url);
            let domain = currentTabUrlBroken != null ? currentTabUrlBroken[4] : undefined;
            // if we couldn't find the domain then we stop running the function.
            if (!domain) {
                return;
            }
            let sitesToPopupOn = filter.url;
            for (let i = 0; i < sitesToPopupOn.length; i++) {
                let siteToPopupOn = sitesToPopupOn[i];
                if (domain.match(new RegExp(siteToPopupOn.hostSuffix + "$"))) {
                    return listener(event);
                }
            }
        });
    };
    let msgListener = function (msg) {
        if (msg !== "clicked") {
            return;
        }
        // if we got the clicked message then we stop to listen, so no more dialog will appear
        unlisten();
        // and we set an alarm to turn it back on again after the cooldown time.
        return chrome.alarms.create({
            delayInMinutes: cooldown,
        });
    };
    // listen to events
    let listen = function () {
        chrome.alarms.clearAll();
        // this will trigger the listener function only if the commited URL is one of the list inside the filter
        chrome.webNavigation.onCommitted.addListener(listener, filter);
        chrome.webNavigation.onTabReplaced.addListener(tabReplacedListener);
        // listen to messages from the content.js
        return chrome.runtime.onMessage.addListener(msgListener);
    };
    // listen to events (when we already presented our dialog...)
    let unlisten = function () {
        chrome.webNavigation.onCommitted.removeListener(listener);
        chrome.webNavigation.onTabReplaced.removeListener(tabReplacedListener);
        return chrome.runtime.onMessage.removeListener(msgListener);
    };
    // triggered when on chrome.storage.onChanged (when the storage is changed, meaning the customer changed his preferences)
    let reload = function () {
        return storage.get(["sites", "cooldown"], function (result) {
            if (!result) {
                return;
            }
            if (Array.isArray(result.sites)) {
                fullSites = result.sites;
                filter = {
                    url: result.sites.map((site) => ({
                        hostSuffix: site.hostSuffix,
                    })),
                };
            }
            if (result.cooldown) {
                cooldown = result.cooldown;
            }
            unlisten();
            return listen();
        });
    };
    storage.get(["sites", "cooldown"], function (result) {
        if (!result) {
            return;
        }
        // if we have results for the sites, we should assign them to the filter.
        //if not we should push the default values to the storage
        if (Array.isArray(result.sites)) {
            fullSites = result.sites;
            filter = {
                url: result.sites.map((site) => ({
                    hostSuffix: site.hostSuffix,
                })),
            };
        }
        else {
            storage.set({
                sites: DEFAULT_SITES,
            });
        }
        // Same for cooldown
        if (result.cooldown) {
            cooldown = result.cooldown;
        }
        else {
            storage.set({
                cooldown: 5,
            });
        }
        return chrome.alarms.get(function (alarm) {
            if (!alarm) {
                return listen();
            }
        });
    });
    // Only start listening if we haven't deliberately removed our listeners (because we're waiting for the alarm to turn them back on).
    chrome.alarms.onAlarm.addListener(listen);
    chrome.storage.onChanged.addListener(reload);
}).call(this);


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/eventPage2.ts"]();
/******/ 	
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDWCxPQUFPLE1BQU0sRUFBRSxDQUFDO1lBQ2xCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsb0lBQW9JO0lBQ3BJLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMxQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDL0MsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDOzs7Ozs7OztVRTdMZDtVQUNBO1VBQ0E7VUFDQTtVQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXJleW91c3VyZS11cGRhdGVkLy4vc3JjL2V2ZW50UGFnZTIudHMiLCJ3ZWJwYWNrOi8vYXJleW91c3VyZS11cGRhdGVkL3dlYnBhY2svYmVmb3JlLXN0YXJ0dXAiLCJ3ZWJwYWNrOi8vYXJleW91c3VyZS11cGRhdGVkL3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9hcmV5b3VzdXJlLXVwZGF0ZWQvd2VicGFjay9hZnRlci1zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS4xMi41XHJcbi8vIEB0cy1ub2NoZWNrXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgLy8gaW5pdGlhbGl6ZSB2YXJpYWJsZXNcclxuICBjb25zdCBERUZBVUxUX1NJVEVTID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgaG9zdFN1ZmZpeDogXCJyZWRkaXQuY29tXCIsXHJcbiAgICAgICAgdXNlRGVmYXVsdEV4cGxhbmF0aW9uOiB0cnVlLFxyXG4gICAgICAgIGV4cGxhbmF0aW9uOiBcIlByb2R1Y3Rpdml0eVwiLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgaG9zdFN1ZmZpeDogXCJuZXdzLnljb21iaW5hdG9yLmNvbVwiLFxyXG4gICAgICAgIHVzZURlZmF1bHRFeHBsYW5hdGlvbjogdHJ1ZSxcclxuICAgICAgICBleHBsYW5hdGlvbjogXCJQcm9kdWN0aXZpdHlcIixcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGhvc3RTdWZmaXg6IFwiZmFjZWJvb2suY29tXCIsXHJcbiAgICAgICAgdXNlRGVmYXVsdEV4cGxhbmF0aW9uOiB0cnVlLFxyXG4gICAgICAgIGV4cGxhbmF0aW9uOiBcIlByb2R1Y3Rpdml0eVwiLFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgaG9zdFN1ZmZpeDogXCJ0d2l0dGVyLmNvbVwiLFxyXG4gICAgICAgIHVzZURlZmF1bHRFeHBsYW5hdGlvbjogdHJ1ZSxcclxuICAgICAgICBleHBsYW5hdGlvbjogXCJQcm9kdWN0aXZpdHlcIixcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGhvc3RTdWZmaXg6IFwibWFrby5jby5pbFwiLFxyXG4gICAgICAgIHVzZURlZmF1bHRFeHBsYW5hdGlvbjogdHJ1ZSxcclxuICAgICAgICBleHBsYW5hdGlvbjogXCJQcm9kdWN0aXZpdHlcIixcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGhvc3RTdWZmaXg6IFwieW5ldC5jby5pbFwiLFxyXG4gICAgICAgIHVzZURlZmF1bHRFeHBsYW5hdGlvbjogdHJ1ZSxcclxuICAgICAgICBleHBsYW5hdGlvbjogXCJQcm9kdWN0aXZpdHlcIixcclxuICAgICAgfSxcclxuICAgIF0sXHJcbiAgICB1cmxSZWdleCA9IC9eKChbXjpcXC8/I10rKTopPyhcXC9cXC8oW15cXC86PyNdKikpPyhbXj8jXSopKFxcPyhbXiNdKikpPygjKC4qKSk/LztcclxuXHJcbiAgbGV0IHN0b3JhZ2UgPSBjaHJvbWUuc3RvcmFnZS5zeW5jLFxyXG4gICAgY29vbGRvd24gPSA1LFxyXG4gICAgZnVsbFNpdGVzID0gREVGQVVMVF9TSVRFUztcclxuICBsZXQgZmlsdGVyID0ge1xyXG4gICAgdXJsOiBERUZBVUxUX1NJVEVTLm1hcCgoc2l0ZSkgPT4gKHsgaG9zdFN1ZmZpeDogc2l0ZS5ob3N0U3VmZml4IH0pKSxcclxuICB9O1xyXG5cclxuICAvKiBUaGUgbGlzdGVuZXIgaXMgd2hlcmUgbW9zdCBvZiB0aGUgYWN0aW9uIGhhcHBlbnMuIFRoaXMgY29kZSBmaXJlcyBvbiBwYWdlIG5hdmlnYXRlIGFuZCBpcyB3aGVyZSB3ZSBpbmplY3QgdGhlIGNvbnRlbnQgc2NyaXB0LlxyXG4gICAgIEF0IHRoaXMgcG9pbnQgZmlsdGVyaW5nIGhhcyBhbHJlYWR5IGhhcHBlbmVkIHNvIHdlIG11c3QgYmUgb24gb25lIG9mIHRoZSBzaXRlcyBpbiBvdXIgZmlsdGVyIGxpc3QuICovXHJcbiAgbGV0IGxpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAvLyBIZXJlIHdlIGNoZWNrIHRoYXQgd2UgYXJlIG9uIHRoZSBtYWluIGZyYW1lLCBhbmQgbm90IGluIHNvbWUga2luZCBvZiBhbiBpZnJhbWUuXHJcbiAgICBpZiAoZXZlbnQuZnJhbWVJZCA+IDApIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBjb250ZW50U2NyaXB0RXhlY3V0aW5nID0gY2hyb21lLnRhYnMuZXhlY3V0ZVNjcmlwdChldmVudC50YWJJZCwge1xyXG4gICAgICBmaWxlOiBcInNyYy9jb250ZW50Mi5qc1wiLFxyXG4gICAgICBydW5BdDogXCJkb2N1bWVudF9zdGFydFwiLFxyXG4gICAgfSk7XHJcblxyXG4gICAgbGV0IGN1cnJlbnRUYWJVcmxCcm9rZW4gPSB1cmxSZWdleC5leGVjKGV2ZW50LnVybCk7XHJcbiAgICBsZXQgZG9tYWluID1cclxuICAgICAgY3VycmVudFRhYlVybEJyb2tlbiAhPSBudWxsID8gY3VycmVudFRhYlVybEJyb2tlbls0XSA6IHVuZGVmaW5lZDtcclxuXHJcbiAgICAvLyBpZiB3ZSBjb3VsZG4ndCBmaW5kIHRoZSBkb21haW4gdGhlbiB3ZSBzdG9wIHJ1bm5pbmcgdGhlIGZ1bmN0aW9uLlxyXG4gICAgaWYgKCFkb21haW4pIHtcclxuICAgICAgY29uc29sZS5sb2coXCJObyBkb21haW4gZm91bmRcIik7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBmaW5kIHRoZSBjdXJyZW50IHNpdGUgb2JqZWN0XHJcbiAgICBsZXQgdGhlQ3VycmVudFNpdGVPYmplY3QgPSBmdWxsU2l0ZXMuZmluZCgoc2l0ZSkgPT5cclxuICAgICAgZG9tYWluLm1hdGNoKG5ldyBSZWdFeHAoc2l0ZS5ob3N0U3VmZml4ICsgXCIkXCIpKVxyXG4gICAgKTtcclxuICAgIGxldCBleHBsYW5hdGlvbiA9IHRoZUN1cnJlbnRTaXRlT2JqZWN0LmV4cGxhbmF0aW9uO1xyXG5cclxuICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKGV2ZW50LnRhYklkLCB7IGV4cGxhbmF0aW9uOiBleHBsYW5hdGlvbiB9KTtcclxuXHJcbiAgICByZXR1cm4gY29udGVudFNjcmlwdEV4ZWN1dGluZztcclxuICB9O1xyXG5cclxuICBsZXQgdGFiUmVwbGFjZWRMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcmV0dXJuIGNocm9tZS50YWJzLmdldChldmVudC50YWJJZCwgZnVuY3Rpb24gKHRhYikge1xyXG4gICAgICBsZXQgY3VycmVudFRhYlVybEJyb2tlbiA9IHVybFJlZ2V4LmV4ZWModGFiLnVybCk7XHJcbiAgICAgIGxldCBkb21haW4gPVxyXG4gICAgICAgIGN1cnJlbnRUYWJVcmxCcm9rZW4gIT0gbnVsbCA/IGN1cnJlbnRUYWJVcmxCcm9rZW5bNF0gOiB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAvLyBpZiB3ZSBjb3VsZG4ndCBmaW5kIHRoZSBkb21haW4gdGhlbiB3ZSBzdG9wIHJ1bm5pbmcgdGhlIGZ1bmN0aW9uLlxyXG4gICAgICBpZiAoIWRvbWFpbikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IHNpdGVzVG9Qb3B1cE9uID0gZmlsdGVyLnVybDtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXRlc1RvUG9wdXBPbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGxldCBzaXRlVG9Qb3B1cE9uID0gc2l0ZXNUb1BvcHVwT25baV07XHJcbiAgICAgICAgaWYgKGRvbWFpbi5tYXRjaChuZXcgUmVnRXhwKHNpdGVUb1BvcHVwT24uaG9zdFN1ZmZpeCArIFwiJFwiKSkpIHtcclxuICAgICAgICAgIHJldHVybiBsaXN0ZW5lcihldmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBsZXQgbXNnTGlzdGVuZXIgPSBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICBpZiAobXNnICE9PSBcImNsaWNrZWRcIikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBpZiB3ZSBnb3QgdGhlIGNsaWNrZWQgbWVzc2FnZSB0aGVuIHdlIHN0b3AgdG8gbGlzdGVuLCBzbyBubyBtb3JlIGRpYWxvZyB3aWxsIGFwcGVhclxyXG4gICAgdW5saXN0ZW4oKTtcclxuICAgIC8vIGFuZCB3ZSBzZXQgYW4gYWxhcm0gdG8gdHVybiBpdCBiYWNrIG9uIGFnYWluIGFmdGVyIHRoZSBjb29sZG93biB0aW1lLlxyXG4gICAgcmV0dXJuIGNocm9tZS5hbGFybXMuY3JlYXRlKHtcclxuICAgICAgZGVsYXlJbk1pbnV0ZXM6IGNvb2xkb3duLFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgLy8gbGlzdGVuIHRvIGV2ZW50c1xyXG4gIGxldCBsaXN0ZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBjaHJvbWUuYWxhcm1zLmNsZWFyQWxsKCk7XHJcbiAgICAvLyB0aGlzIHdpbGwgdHJpZ2dlciB0aGUgbGlzdGVuZXIgZnVuY3Rpb24gb25seSBpZiB0aGUgY29tbWl0ZWQgVVJMIGlzIG9uZSBvZiB0aGUgbGlzdCBpbnNpZGUgdGhlIGZpbHRlclxyXG4gICAgY2hyb21lLndlYk5hdmlnYXRpb24ub25Db21taXR0ZWQuYWRkTGlzdGVuZXIobGlzdGVuZXIsIGZpbHRlcik7XHJcbiAgICBjaHJvbWUud2ViTmF2aWdhdGlvbi5vblRhYlJlcGxhY2VkLmFkZExpc3RlbmVyKHRhYlJlcGxhY2VkTGlzdGVuZXIpO1xyXG4gICAgLy8gbGlzdGVuIHRvIG1lc3NhZ2VzIGZyb20gdGhlIGNvbnRlbnQuanNcclxuICAgIHJldHVybiBjaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIobXNnTGlzdGVuZXIpO1xyXG4gIH07XHJcblxyXG4gIC8vIGxpc3RlbiB0byBldmVudHMgKHdoZW4gd2UgYWxyZWFkeSBwcmVzZW50ZWQgb3VyIGRpYWxvZy4uLilcclxuICBsZXQgdW5saXN0ZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBjaHJvbWUud2ViTmF2aWdhdGlvbi5vbkNvbW1pdHRlZC5yZW1vdmVMaXN0ZW5lcihsaXN0ZW5lcik7XHJcbiAgICBjaHJvbWUud2ViTmF2aWdhdGlvbi5vblRhYlJlcGxhY2VkLnJlbW92ZUxpc3RlbmVyKHRhYlJlcGxhY2VkTGlzdGVuZXIpO1xyXG4gICAgcmV0dXJuIGNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5yZW1vdmVMaXN0ZW5lcihtc2dMaXN0ZW5lcik7XHJcbiAgfTtcclxuXHJcbiAgLy8gdHJpZ2dlcmVkIHdoZW4gb24gY2hyb21lLnN0b3JhZ2Uub25DaGFuZ2VkICh3aGVuIHRoZSBzdG9yYWdlIGlzIGNoYW5nZWQsIG1lYW5pbmcgdGhlIGN1c3RvbWVyIGNoYW5nZWQgaGlzIHByZWZlcmVuY2VzKVxyXG4gIGxldCByZWxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gc3RvcmFnZS5nZXQoW1wic2l0ZXNcIiwgXCJjb29sZG93blwiXSwgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXN1bHQuc2l0ZXMpKSB7XHJcbiAgICAgICAgZnVsbFNpdGVzID0gcmVzdWx0LnNpdGVzO1xyXG4gICAgICAgIGZpbHRlciA9IHtcclxuICAgICAgICAgIHVybDogcmVzdWx0LnNpdGVzLm1hcCgoc2l0ZSkgPT4gKHtcclxuICAgICAgICAgICAgaG9zdFN1ZmZpeDogc2l0ZS5ob3N0U3VmZml4LFxyXG4gICAgICAgICAgfSkpLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHJlc3VsdC5jb29sZG93bikge1xyXG4gICAgICAgIGNvb2xkb3duID0gcmVzdWx0LmNvb2xkb3duO1xyXG4gICAgICB9XHJcbiAgICAgIHVubGlzdGVuKCk7XHJcbiAgICAgIHJldHVybiBsaXN0ZW4oKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHN0b3JhZ2UuZ2V0KFtcInNpdGVzXCIsIFwiY29vbGRvd25cIl0sIGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgIGlmICghcmVzdWx0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZiB3ZSBoYXZlIHJlc3VsdHMgZm9yIHRoZSBzaXRlcywgd2Ugc2hvdWxkIGFzc2lnbiB0aGVtIHRvIHRoZSBmaWx0ZXIuXHJcbiAgICAvL2lmIG5vdCB3ZSBzaG91bGQgcHVzaCB0aGUgZGVmYXVsdCB2YWx1ZXMgdG8gdGhlIHN0b3JhZ2VcclxuICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdC5zaXRlcykpIHtcclxuICAgICAgZnVsbFNpdGVzID0gcmVzdWx0LnNpdGVzO1xyXG4gICAgICBmaWx0ZXIgPSB7XHJcbiAgICAgICAgdXJsOiByZXN1bHQuc2l0ZXMubWFwKChzaXRlKSA9PiAoe1xyXG4gICAgICAgICAgaG9zdFN1ZmZpeDogc2l0ZS5ob3N0U3VmZml4LFxyXG4gICAgICAgIH0pKSxcclxuICAgICAgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHN0b3JhZ2Uuc2V0KHtcclxuICAgICAgICBzaXRlczogREVGQVVMVF9TSVRFUyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2FtZSBmb3IgY29vbGRvd25cclxuICAgIGlmIChyZXN1bHQuY29vbGRvd24pIHtcclxuICAgICAgY29vbGRvd24gPSByZXN1bHQuY29vbGRvd247XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdG9yYWdlLnNldCh7XHJcbiAgICAgICAgY29vbGRvd246IDUsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNocm9tZS5hbGFybXMuZ2V0KGZ1bmN0aW9uIChhbGFybSkge1xyXG4gICAgICBpZiAoIWFsYXJtKSB7XHJcbiAgICAgICAgcmV0dXJuIGxpc3RlbigpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgLy8gT25seSBzdGFydCBsaXN0ZW5pbmcgaWYgd2UgaGF2ZW4ndCBkZWxpYmVyYXRlbHkgcmVtb3ZlZCBvdXIgbGlzdGVuZXJzIChiZWNhdXNlIHdlJ3JlIHdhaXRpbmcgZm9yIHRoZSBhbGFybSB0byB0dXJuIHRoZW0gYmFjayBvbikuXHJcbiAgY2hyb21lLmFsYXJtcy5vbkFsYXJtLmFkZExpc3RlbmVyKGxpc3Rlbik7XHJcbiAgY2hyb21lLnN0b3JhZ2Uub25DaGFuZ2VkLmFkZExpc3RlbmVyKHJlbG9hZCk7XHJcbn0pLmNhbGwodGhpcyk7XHJcbiIsIiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0ge307XG5fX3dlYnBhY2tfbW9kdWxlc19fW1wiLi9zcmMvZXZlbnRQYWdlMi50c1wiXSgpO1xuIiwiIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9